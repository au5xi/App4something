# /server/railway.toml
# Config-as-Code for the API service (Node/Express + Prisma + PostgreSQL)
# This file is evaluated for the service that builds from /server.
# Docs: https://docs.railway.com/guides/config-as-code  (per-service), Railpack builder details. 

[build]
builder = "RAILPACK"
# We’re in a workspace monorepo; ensure install + build runs correctly from the root context.
# Railpack will run commands relative to the service root (/server).
# If you prefer to use workspace install from the repo root, you can set a custom build command in the dashboard.
# Here we rely on package.json scripts in /server:
#   "build": "tsc -p tsconfig.json"
# Railpack will detect Node and run install automatically; buildCommand is optional.
# Uncomment to force:
# buildCommand = "npm run build"

[deploy]
# Start the compiled server (Railpack will infer if omitted, but we set explicitly)
startCommand = "npm start"
# Health check so Railway knows when the API is healthy
healthcheckPath = "/api/health"
healthcheckTimeout = 100
restartPolicyType = "always"

# Optional pre-deploy hook to run migrations automatically on each deploy.
# If you prefer manual control, comment these lines and run via the Shell.
# preDeployCommand = [
#   "npx prisma migrate deploy",
#   "node -e \"console.log('Skipping seed in CI; run once manually if needed')\""
# ]

# Environment you’ll set in the Railway service UI (shown here for reference):
#   DATABASE_URL  -> injected automatically after you add the PostgreSQL plugin
#   JWT_SECRET    -> your secret
#   CORS_ORIGIN   -> your frontend URL (set after web is deployed)
#   PORT          -> 4000
``